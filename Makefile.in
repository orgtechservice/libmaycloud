
############################ AUTOCONF VARS ###################################
HOST_SYSTEM:=@host@
HOST_CPU:=@host_cpu@
HOST_VENDOR:=@host_vendor@
HOST_OS:=@host_os@

BUILD_SYSTEM:=@build@
BUILD_CPU:=@build_cpu@
BUILD_VENDOR:=@build_vendor@
BUILD_OS:=@build_os@

TARGET_SYSTEM:=@target@
TARGET_CPU:=@target_cpu@
TARGET_VENDOR:=@target_vendor@
TARGET_OS:=@target_os@

DEB_ARCH:=@DEB_ARCH@

CXXFLAGS=@CXXFLAGS@
CXX:=@CXX@ $(CXXFLAGS) -ffunction-sections -I.
AR:=ar
RANLIB:=ranlib

############################### VARS #########################################

DEB_FILENAME=libmaycloud-$(DEB_ARCH).deb

OBJECTS+=obj/asn1reader.o
OBJECTS+=obj/asyncagent.o
OBJECTS+=obj/asyncdns.o
OBJECTS+=obj/asyncobject.o
OBJECTS+=obj/asyncserver.o
OBJECTS+=obj/asyncstream.o
OBJECTS+=obj/asyncudpserver.o
OBJECTS+=obj/asyncxmlstream.o
OBJECTS+=obj/attagparser.o
OBJECTS+=obj/configurer.o
OBJECTS+=obj/controlagent.o
OBJECTS+=obj/controlstream.o
OBJECTS+=obj/debug.o
OBJECTS+=obj/easylib.o
OBJECTS+=obj/easylist.o
OBJECTS+=obj/easymysql.o
OBJECTS+=obj/easyresultset.o
OBJECTS+=obj/easyrow.o
OBJECTS+=obj/easyvector.o
OBJECTS+=obj/error.o
OBJECTS+=obj/fstream.o
OBJECTS+=obj/hasher.o
OBJECTS+=obj/heavyhash.o
OBJECTS+=obj/iputils.o
OBJECTS+=obj/ipv4.o
OBJECTS+=obj/logger.o
OBJECTS+=obj/macaddress.o
OBJECTS+=obj/macaddress64.o
OBJECTS+=obj/mysql.o
OBJECTS+=obj/mysqlconnect.o
OBJECTS+=obj/netdaemon.o
OBJECTS+=obj/object.o
OBJECTS+=obj/oid.o
OBJECTS+=obj/processmanager.o
OBJECTS+=obj/queue.o
OBJECTS+=obj/randomstring.o
OBJECTS+=obj/snmpbuilder.o
OBJECTS+=obj/snmpparser.o
OBJECTS+=obj/stack.o
OBJECTS+=obj/tagbuilder.o
OBJECTS+=obj/taghelper.o
OBJECTS+=obj/tempstring.o
OBJECTS+=obj/xml_tag.o
OBJECTS+=obj/xml_types.o
OBJECTS+=obj/xmlparser.o
OBJECTS+=obj/xmlwriter.o

############################# GENERIC RULES ##################################

.PHONY: all install deb clean distclean
all: libmaycloud.a

install: libmaycloud.a
	install -o root -g root libmaycloud.a /usr/lib/
	mkdir -p /usr/include/maycloud
	install -o root -g root maycloud/*.h /usr/include/maycloud/

deb: $(DEB_FILENAME)

$(DEB_FILENAME): deb_install
	fakeroot dpkg-deb --build deb $(DEB_FILENAME)

.PHONY: deb_install
deb_install: libmaycloud.a
	mkdir -p deb/usr/lib
	cp libmaycloud.a deb/usr/lib/
	mkdir -p deb/usr/include/maycloud/
	cp maycloud/*.h deb/usr/include/maycloud/

libmaycloud.a: $(OBJECTS)
	$(AR) rc libmaycloud.a $(OBJECTS)
	$(RANLIB) libmaycloud.a

########################## BUILD RULES #######################################

obj/asn1reader.o: maycloud/asn1reader.cpp maycloud/asn1reader.h
	$(CXX) -c maycloud/asn1reader.cpp -o obj/asn1reader.o

obj/asyncagent.o: maycloud/asyncagent.cpp maycloud/asyncagent.h
	$(CXX) -c maycloud/asyncagent.cpp -o obj/asyncagent.o

obj/asyncdns.o: maycloud/asyncdns.cpp maycloud/asyncdns.h
	$(CXX) -c maycloud/asyncdns.cpp -o obj/asyncdns.o

obj/asyncobject.o: maycloud/asyncobject.cpp maycloud/asyncobject.h
	$(CXX) -c maycloud/asyncobject.cpp -o obj/asyncobject.o

obj/asyncserver.o: maycloud/asyncserver.cpp maycloud/asyncserver.h
	$(CXX) -c maycloud/asyncserver.cpp -o obj/asyncserver.o

obj/asyncstream.o: maycloud/asyncstream.cpp maycloud/asyncstream.h maycloud/config.h
	$(CXX) -c maycloud/asyncstream.cpp -o obj/asyncstream.o

obj/asyncudpserver.o: maycloud/asyncudpserver.cpp maycloud/asyncudpserver.h
	$(CXX) -c maycloud/asyncudpserver.cpp -o obj/asyncudpserver.o

obj/asyncxmlstream.o: maycloud/asyncxmlstream.cpp maycloud/asyncxmlstream.h
	$(CXX) -c maycloud/asyncxmlstream.cpp -o obj/asyncxmlstream.o

obj/attagparser.o: maycloud/attagparser.cpp maycloud/attagparser.h maycloud/xml_types.h
	$(CXX) -c maycloud/attagparser.cpp -o obj/attagparser.o

obj/configurer.o: maycloud/configurer.cpp maycloud/configurer.h
	$(CXX) -c maycloud/configurer.cpp -o obj/configurer.o

obj/controlagent.o: maycloud/controlagent.cpp maycloud/controlagent.h
	$(CXX) -c maycloud/controlagent.cpp -o obj/controlagent.o

obj/controlstream.o: maycloud/controlstream.cpp maycloud/controlstream.h maycloud/config.h
	$(CXX) -c maycloud/controlstream.cpp -o obj/controlstream.o

obj/debug.o: maycloud/debug.cpp maycloud/debug.h
	$(CXX) -c maycloud/debug.cpp -o obj/debug.o

obj/easylib.o: maycloud/easylib.cpp maycloud/easylib.h
	$(CXX) -c maycloud/easylib.cpp -o obj/easylib.o

obj/easymysql.o: maycloud/easymysql.cpp maycloud/easymysql.h maycloud/easyrow.h maycloud/easyresultset.h
	$(CXX) -c maycloud/easymysql.cpp -o obj/easymysql.o

obj/easylist.o: maycloud/easylist.cpp maycloud/easylist.h
	$(CXX) -c maycloud/easylist.cpp -o obj/easylist.o

obj/easyresultset.o: maycloud/easyresultset.cpp maycloud/easyrow.h maycloud/easyresultset.h
	$(CXX) -c maycloud/easyresultset.cpp -o obj/easyresultset.o
	
obj/easyrow.o: maycloud/easyrow.cpp maycloud/easyrow.h
	$(CXX) -c maycloud/easyrow.cpp -o obj/easyrow.o

obj/easyvector.o: maycloud/easyvector.cpp maycloud/easyvector.h
	$(CXX) -c maycloud/easyvector.cpp -o obj/easyvector.o

obj/error.o: maycloud/error.cpp maycloud/error.h
	$(CXX) -c maycloud/error.cpp -o obj/error.o

obj/fstream.o: maycloud/fstream.cpp maycloud/fstream.h maycloud/stream.h
	$(CXX) -c maycloud/fstream.cpp -o obj/fstream.o

obj/hasher.o: maycloud/hasher.cpp maycloud/hasher.h
	$(CXX) -c maycloud/hasher.cpp -o obj/hasher.o

obj/heavyhash.o: maycloud/heavyhash.cpp maycloud/heavyhash.h maycloud/hasher.h
	$(CXX) -c maycloud/heavyhash.cpp -o obj/heavyhash.o

obj/iputils.o: maycloud/iputils.cpp maycloud/iputils.h
	$(CXX) -c maycloud/iputils.cpp -o obj/iputils.o

obj/ipv4.o: maycloud/ipv4.cpp maycloud/ipv4.h maycloud/tempstring.h
	$(CXX) -c maycloud/ipv4.cpp -o obj/ipv4.o

obj/logger.o: maycloud/logger.cpp maycloud/logger.h
	$(CXX) -c maycloud/logger.cpp -o obj/logger.o

obj/macaddress.o: maycloud/macaddress.cpp maycloud/macaddress.h maycloud/tempstring.h
	$(CXX) -c maycloud/macaddress.cpp -o obj/macaddress.o

obj/macaddress64.o: maycloud/macaddress64.cpp maycloud/macaddress64.h maycloud/tempstring.h
	$(CXX) -c maycloud/macaddress64.cpp -o obj/macaddress64.o

obj/mysql.o: maycloud/mysql.cpp maycloud/mysql.h maycloud/config.h
	$(CXX) -c maycloud/mysql.cpp -o obj/mysql.o

obj/mysqlconnect.o: maycloud/mysqlconnect.cpp maycloud/mysqlconnect.h
	$(CXX) -c maycloud/mysqlconnect.cpp -o obj/mysqlconnect.o

obj/netdaemon.o: maycloud/netdaemon.cpp maycloud/netdaemon.h maycloud/config.h maycloud/processmanager.h
	$(CXX) -c maycloud/netdaemon.cpp -o obj/netdaemon.o

obj/object.o: maycloud/object.cpp maycloud/object.h
	$(CXX) -c maycloud/object.cpp -o obj/object.o

obj/oid.o: maycloud/oid.cpp maycloud/oid.h maycloud/tempstring.h
	$(CXX) -c maycloud/oid.cpp -o obj/oid.o

obj/processmanager.o: maycloud/processmanager.cpp maycloud/processmanager.h
	$(CXX) -c maycloud/processmanager.cpp -o obj/processmanager.o

obj/queue.o: maycloud/queue.cpp maycloud/queue.h
	$(CXX) -c maycloud/queue.cpp -o obj/queue.o

obj/randomstring.o: maycloud/randomstring.cpp maycloud/randomstring.h
	$(CXX) -c maycloud/randomstring.cpp -o obj/randomstring.o

obj/snmpbuilder.o: maycloud/snmpbuilder.cpp maycloud/snmpbuilder.h
	$(CXX) -c maycloud/snmpbuilder.cpp -o obj/snmpbuilder.o

obj/snmpparser.o: maycloud/snmpparser.cpp maycloud/snmpparser.h
	$(CXX) -c maycloud/snmpparser.cpp -o obj/snmpparser.o

obj/stack.o: maycloud/stack.cpp maycloud/stack.h
	$(CXX) -c maycloud/stack.cpp -o obj/stack.o

obj/tagbuilder.o: maycloud/tagbuilder.cpp maycloud/tagbuilder.h maycloud/xml_types.h
	$(CXX) -c maycloud/tagbuilder.cpp -o obj/tagbuilder.o

obj/taghelper.o: maycloud/taghelper.cpp maycloud/taghelper.h maycloud/xml_types.h
	$(CXX) -c maycloud/taghelper.cpp -o obj/taghelper.o

obj/tempstring.o: maycloud/tempstring.cpp maycloud/tempstring.h
	$(CXX) -c maycloud/tempstring.cpp -o obj/tempstring.o

obj/xml_tag.o: maycloud/xml_tag.cpp maycloud/xml_tag.h maycloud/xml_types.h
	$(CXX) -c maycloud/xml_tag.cpp -o obj/xml_tag.o

obj/xml_types.o: maycloud/xml_types.cpp maycloud/xml_types.h
	$(CXX) -c maycloud/xml_types.cpp -o obj/xml_types.o

obj/xmlparser.o: maycloud/xmlparser.cpp maycloud/xmlparser.h
	$(CXX) -c maycloud/xmlparser.cpp -o obj/xmlparser.o

obj/xmlwriter.o: maycloud/xmlwriter.cpp maycloud/xmlwriter.h
	$(CXX) -c maycloud/xmlwriter.cpp -o obj/xmlwriter.o

########################### CLEAN RULES ######################################

distclean: clean deb_clean
	rm -f Makefile $(DEB_FILENAME) libmaycloud.a deb/DEBIAN/control
	rm -f config.log config.status
	rm -rf autom4te.cache

clean:
	rm -f obj/*.o

.PHONY: deb_clean
deb_clean:
	rm -rf deb/usr
